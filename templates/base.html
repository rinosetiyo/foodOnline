{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>FoodOnline</title>
	<!-- Google Font Family Link Start -->
	<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Montserrat:400,700">
	<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700,800">
	<!-- Google Font Family Link End -->

	<!-- CSS -->
	<link href="{% static 'css/iconmoon.css' %}" rel="stylesheet">
	<link href="{% static 'css/style.css' %}" rel="stylesheet">
	<link href="{% static 'css/cs-foodbakery-plugin.css' %}" rel="stylesheet">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
	<link href="{% static 'css/bootstrap-slider.css' %}" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
	
	<!-- JAVASCRIPT -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<script src="{% static 'js/modernizr.js' %}"></script>
	<script src="{% static 'js/bootstrap.js' %}"></script>
	<script src="{% static 'js/jquery.js' %}"></script>
	<script>
		// add_to_cart
		$(document).ready(function() {
			// add to cart
			$('.add_to_cart').on('click', function(e){
				e.preventDefault();
	
				food_id = $(this).attr('data-id');
				url = $(this).attr('data-url');
	
				data = {
					food_id: food_id,
				}
				$.ajax({
					type:'GET',
					url: url,
					data: data,
					success: function(response){
						console.log(response)
						$('#cart_counter').html(response.cart_counter['cart_count'])
						$('#qty-'+ food_id).html(response.qty)

						applyCartAmount(
							response.cart_amount['subtotal'],
							response.cart_amount['tax'],
							response.cart_amount['grand_total']
						)
					}
				})
			})
	
			// place the cart item quantity on load
			$('.item_qty').each(function(){
				var the_id = $(this).attr('id')
				var qty = $(this).attr('data-qty')
				$('#'+ the_id).html(qty)
			})
		

			// decrease cart
			$('.decrease_cart').on('click', function(e){
				e.preventDefault();
				food_id = $(this).attr('data-id');
				cart_id = $(this).attr('id'); // use in the cart.html
				url = $(this).attr('data-url');

				$.ajax({
					type:'GET',
					url: url,
					success: function(response){
						console.log(response)
						if(response.status == 'failed'){
							console.log(response)
						} else{
							$('#cart_counter').html(response.cart_counter['cart_count']);
							$('#qty-'+ food_id).html(response.qty);

							if(window.location.pathname == '/cart/'){
								removecartItem(response.qty, cart_id);
								checkEmptyCart();
							}
						}
					}
				})
			})

			//delete cart item
			$('.delete_cart').on('click', function(e){
				e.preventDefault();
				cart_id = $(this).attr('data-id');
				url = $(this).attr('data-url');

				$.ajax({
					type:'GET',
					url: url,
					success: function(response){
						console.log(response)
						if(response.status == 'failed'){
							console.log(response)
						} else{
							$('#cart_counter').html(response.cart_counter['cart_count']);
							console.log(response)
							removecartItem(0, cart_id);
							checkEmptyCart();
						}
					}
				})
			})
			
			// delete cart element
			function removecartItem(cartItemQty, cart_id){
				if(cartItemQty <=0){
					document.getElementById('cart-item-'+ cart_id).remove()
				}
			}

			// check if the cart is empty
			function checkEmptyCart(){
				var cart_counter = document.getElementById('cart_counter').innerHTML
				if(cart_counter == 0){
					document.getElementById('empty-cart').style.display = "block";
				}
			}

			// applyCartAmount
			function applyCartAmount(subtotal, tax, grand_total){
				if(window.location.pathname == '/cart/'){
					$('#subtotal').html(subtotal)
					$('#tax').html(tax)
					$('#grand_total').html(grand_total)
				}
			}
		});
	</script>
	<style>
		body, .main-section p, .mce-content-body p{
			font:Normal  14px/24px "Open Sans", sans-serif;letter-spacing: 0px;text-transform: none;color: #515151 !important;
		}
	</style>
</head>

<body>
	<!--Main Wrapper-->
	<div class="wrapper">
        {% include "includes/navbar.html" %}

		{% block content %}
        {% endblock content %}
		
        {% include "includes/footer.html" %}
	</div>
	
	<!-- Modal Popup End -->
	<script src="{% static 'js/scripts.js' %}"></script>
	<script src="{% static 'js/functions.js' %}"></script>
</body>

</html>